
以下包含新增與修改流程。使用訂單id=14025,14026
如果執行後要重來，請開啟資料表 invoice_group_orders
刪除 訂單id=14025,14026

新增發票群組
method:POST
api網址：{{BaseUrl}}/api/posv2/sales/invoices/groups

body json
{
  "備註": "開票方式 standard/split/merge/mixed 的 json 結構大致上相同。差別只是 invoices 裡面有幾組。",
  "order_ids": "14025,14026",
  "invoice_issue_mode": "mixed",
  "invoices": [
    {
      "invoice_type": "single",
      "invoice_date": "2025-01-30",
      "customer_id": 456,
      "buyer_name": "台灣科技股份有限公司",
      "seller_name": "前瞻系統設計股份有限公司",
      "tax_id_number": "12345678",
      "tax_type": "taxable",
      "tax_state": 1,
      "email": "accounting@company.com",
      "content": "合併開立發票",
      "carrier_type": "none",
      "carrier_number": null,
      "donation_code": null,
      "invoice_items": [
        {
          "name": "EdgeLink 分散式物聯網模組（企業版授權）",
          "quantity": 10,
          "price": 476.19,
          "is_tax_included": false,
          "remark": "未稅單價"
        },
        {
          "name": "NeuraSync AI 數據整合核心套件",
          "quantity": 5,
          "price": 761.90,
          "is_tax_included": false,
          "remark": "未稅單價"
        }
      ]
    },
    {
      "invoice_type": "single",
      "invoice_date": "2025-01-30",
      "buyer_name": "台灣科技股份有限公司",
      "tax_id_number": "12345678",
      "tax_type": "taxable",
      "tax_state": 1,
      "carrier_type": "none",
      "invoice_items": [
        {
          "name": "QuantumFlow 運算優化引擎授權",
          "quantity": 3,
          "price": 952.38,
          "is_tax_included": false
        },
        {
          "name": "SkyMatrix 雲端監控模組（專業版）",
          "quantity": 2,
          "price": 666.67,
          "is_tax_included": false
        },
        {
          "name": "AstraGuard 系統安全加值服務",
          "quantity": 1,
          "price": 1190.48,
          "is_tax_included": false
        }
      ]
    }
  ]
}

會得到如下回傳
{
    "success": true,
    "message": "發票群組建立成功",
    "data": {
        "group_no": "20250028",
        "group_id": 58,
        "invoice_issue_mode": "mixed",
        "order_count": 2,
        "order_ids": [
            14025,
            14026
        ],
        "invoice_count": 2,
        "total_amount": "13952.00",
        "invoices": [
            {
                "id": 41,
                "invoice_number": null,
                "status": "pending",
                "total_amount": "8571.00",
                "invoice_items": [
                    {
                        "id": 98,
                        "name": "EdgeLink 分散式物聯網模組（企業版授權）",
                        "quantity": "10.000",
                        "price": "476.190",
                        "subtotal": "4761.900"
                    },
                    {
                        "id": 99,
                        "name": "NeuraSync AI 數據整合核心套件",
                        "quantity": "5.000",
                        "price": "761.900",
                        "subtotal": "3809.500"
                    }
                ]
            },
            {
                "id": 42,
                "invoice_number": null,
                "status": "pending",
                "total_amount": "5381.00",
                "invoice_items": [
                    {
                        "id": 100,
                        "name": "QuantumFlow 運算優化引擎授權",
                        "quantity": "3.000",
                        "price": "952.380",
                        "subtotal": "2857.140"
                    },
                    {
                        "id": 101,
                        "name": "SkyMatrix 雲端監控模組（專業版）",
                        "quantity": "2.000",
                        "price": "666.670",
                        "subtotal": "1333.340"
                    },
                    {
                        "id": 102,
                        "name": "AstraGuard 系統安全加值服務",
                        "quantity": "1.000",
                        "price": "1190.480",
                        "subtotal": "1190.480"
                    }
                ]
            }
        ]
    }
}

修改
method: PUT
api網址：{{BaseUrl}}/api/posv2/sales/invoices/groups/{id}
記得修改網址的 {id} 跟 body 的 group_no

body json
{
  "備註": "開票方式 standard/split/merge/mixed 的 json 結構大致上相同。差別只是 invoices 裡面有幾組。",
  "group_no": "20250028",
  "order_ids": "14025,14026",
  "invoice_issue_mode": "mixed",
  "invoices": [
    {
      "invoice_type": "single",
      "invoice_date": "2025-01-30",
      "customer_id": 456,
      "buyer_name": "台灣科技股份有限公司",
      "seller_name": "前瞻系統設計股份有限公司",
      "tax_id_number": "12345678",
      "tax_type": "taxable",
      "tax_state": 1,
      "email": "accounting@company.com",
      "content": "合併開立發票",
      "carrier_type": "none",
      "carrier_number": null,
      "donation_code": null,
      "invoice_items": [
        {
          "name": "EdgeLink 分散式物聯網模組（企業版授權）",
          "quantity": 10,
          "price": 476.19,
          "is_tax_included": false,
          "remark": "未稅單價"
        },
        {
          "name": "NeuraSync AI 數據整合核心套件",
          "quantity": 5,
          "price": 761.90,
          "is_tax_included": false,
          "remark": "未稅單價"
        }
      ]
    },
    {
      "invoice_type": "single",
      "invoice_date": "2025-01-30",
      "buyer_name": "台灣科技股份有限公司",
      "tax_id_number": "12345678",
      "tax_type": "taxable",
      "tax_state": 1,
      "carrier_type": "none",
      "invoice_items": [
        {
          "name": "QuantumFlow 運算優化引擎授權",
          "quantity": 3,
          "price": 952.38,
          "is_tax_included": false
        },
        {
          "name": "SkyMatrix 雲端監控模組（專業版）",
          "quantity": 2,
          "price": 666.67,
          "is_tax_included": false
        },
        {
          "name": "AstraGuard 系統安全加值服務",
          "quantity": 1,
          "price": 1190.48,
          "is_tax_included": false
        }
      ]
    }
  ]
}

得到如下回覆
{
  "success": true,
  "message": "發票群組更新成功",
  "data": {
    "group_no": "20250028",
    "group_id": 58,
    "invoice_issue_mode": "mixed",
    "order_count": 2,
    "order_ids": [
      14025,
      14026
    ],
    "invoice_count": 2,
    "total_amount": "13952.00",
    "invoices": [
      {
        "id": 43,
        "invoice_number": null,
        "status": "pending",
        "total_amount": "8571.00",
        "invoice_items": [
          {
            "id": 103,
            "name": "EdgeLink 分散式物聯網模組（企業版授權）",
            "quantity": "10.000",
            "price": "476.190",
            "subtotal": "4761.900"
          },
          {
            "id": 104,
            "name": "NeuraSync AI 數據整合核心套件",
            "quantity": "5.000",
            "price": "761.900",
            "subtotal": "3809.500"
          }
        ]
      },
      {
        "id": 44,
        "invoice_number": null,
        "status": "pending",
        "total_amount": "5381.00",
        "invoice_items": [
          {
            "id": 105,
            "name": "QuantumFlow 運算優化引擎授權",
            "quantity": "3.000",
            "price": "952.380",
            "subtotal": "2857.140"
          },
          {
            "id": 106,
            "name": "SkyMatrix 雲端監控模組（專業版）",
            "quantity": "2.000",
            "price": "666.670",
            "subtotal": "1333.340"
          },
          {
            "id": 107,
            "name": "AstraGuard 系統安全加值服務",
            "quantity": "1.000",
            "price": "1190.480",
            "subtotal": "1190.480"
          }
        ]
      }
    ]
  }
}
